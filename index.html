<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IceChocolate üç´</title>

<style>
:root{
  --bg:#f6e8c3;
  --card:#ffffff;
  --text:#000;
  --primary:#3b1f0f;
}
body.dark{
  --bg:#121212;
  --card:#1f1f1f;
  --text:#ffffff;
  --primary:#bb86fc;
}
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:var(--bg);
  color:var(--text);
  transition:.3s;
}
header{
  background:var(--primary);
  color:#fff;
  padding:15px;
  display:flex;
  justify-content:space-between;
}
nav{
  padding:10px;
}
nav button{
  margin:5px;
  padding:8px 14px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.page{display:none;padding:20px;animation:fade .4s}
.page.active{display:block}
.card{
  background:var(--card);
  padding:15px;
  margin:10px;
  border-radius:15px;
  box-shadow:0 5px 15px rgba(0,0,0,.2);
  width:260px;
}
.card img{width:100%;border-radius:12px}
.grid{display:flex;flex-wrap:wrap}
button.primary{
  background:var(--primary);
  color:#fff;
  border:none;
  padding:8px 14px;
  border-radius:6px;
  cursor:pointer;
}
footer{
  position:fixed;
  bottom:0;width:100%;
  background:var(--card);
  padding:10px;
}
.search-box input{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid #aaa;
}
.hidden{display:none}
@keyframes fade{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1}
}

/* PAYMENT MODAL */
#paymentModal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
}
.modal{
  background:var(--card);
  padding:20px;
  border-radius:12px;
  width:300px;
  margin:120px auto;
}
</style>
</head>

<body>

<header>
  <b>IceChocolate üç®</b>
  <div id="userBox">
    <button onclick="login()" class="primary">Login</button>
  </div>
</header>

<nav>
  <button onclick="show('home')">Home</button>
  <button onclick="show('shop')">Shop</button>
  <button onclick="show('orders')">Orders</button>
  <button onclick="show('account')">My Account</button>
</nav>

<!-- HOME -->
<div id="home" class="page active">
  <h2>Welcome to IceChocolate üç´</h2>
  <p>
    IceChocolate is your destination for <b>healthy ice creams and chocolates</b>
    made using premium cocoa, fresh fruits üçì and zero-compromise ingredients.
  </p>

  <p>
    We focus on:
  </p>
  <ul>
    <li>üç¶ Low-sugar & protein-rich desserts</li>
    <li>üç´ Rich chocolate flavors without guilt</li>
    <li>üå± Clean ingredients & no artificial junk</li>
  </ul>

  <p>
    Browse our shop, add your favorite treats to cart, and experience our
    smooth demo checkout system.
  </p>

  <button onclick="show('shop')" class="primary">Start Shopping</button>
</div>

<!-- SHOP -->
<div id="shop" class="page">
  <h2>Shop</h2>

  <div class="search-box">
    <input id="searchInput" placeholder="Search desserts..." onkeyup="searchProducts()">
  </div>

  <p id="noResult" class="hidden">‚ùå No product found</p>

  <div class="grid" id="productGrid">

    <div class="card product" data-name="Velvet Crush">
      <h3>Velvet Crush</h3>
      <p>Soft, creamy & rich cocoa layers</p>
      <p><b>‚Çπ180</b></p>
      <button onclick="add('Velvet Crush',180)" class="primary">Add</button>
    </div>

    <div class="card product" data-name="Strata Sweets">
      <h3>Strata Sweets</h3>
      <p>Light texture with fruity sweetness</p>
      <p><b>‚Çπ160</b></p>
      <button onclick="add('Strata Sweets',160)" class="primary">Add</button>
    </div>

    <div class="card product" data-name="Velvet Layers">
      <h3>Velvet Layers</h3>
      <p>Luxury chocolate & cream blend</p>
      <p><b>‚Çπ190</b></p>
      <button onclick="add('Velvet Layers',190)" class="primary">Add</button>
    </div>

  </div>
</div>

<!-- ORDERS -->
<div id="orders" class="page">
  <h2>Your Orders</h2>
  <ul id="orderList"></ul>
</div>

<!-- ACCOUNT -->
<div id="account" class="page">
  <h2>My Account</h2>
  <label>
    <input type="checkbox" onchange="toggleTheme(this)"> Dark Mode
  </label>
</div>

<footer>
  <span id="cartText">Cart empty</span>
  <button onclick="startPayment()" class="primary" style="float:right">Checkout</button>
</footer>

<!-- DEMO PAYMENT -->
<div id="paymentModal">
  <div class="modal">
    <h3>Demo Payment</h3>
    <p>Total: ‚Çπ<span id="payAmount">0</span></p>
    <button onclick="pay('UPI')" class="primary">Pay with UPI</button>
    <button onclick="pay('Card')" class="primary">Pay with Card</button>
    <button onclick="closePay()">Cancel</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig={
  apiKey:"AIzaSyAm-QUwp0pr0997PdvhMwcDJapL8sGXyWc",
  authDomain:"cafw-32f1d.firebaseapp.com",
  projectId:"cafw-32f1d"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);
const provider=new GoogleAuthProvider();

let user=null,cart=[];

window.login=()=>signInWithPopup(auth,provider);
window.logout=()=>signOut(auth);

onAuthStateChanged(auth,async u=>{
  if(u){
    user=u;
    userBox.innerHTML=`${u.email} <button onclick="logout()">Logout</button>`;
    const snap=await getDocs(query(collection(db,"orders"),where("uid","==",u.uid)));
    orderList.innerHTML="";
    snap.forEach(d=>{
      let li=document.createElement("li");
      li.textContent=`${d.data().items.length} items - ${d.data().payment || "Demo"}`;
      orderList.appendChild(li);
    });
  }
});

window.add=(n,p)=>{
  cart.push({name:n,price:p});
  cartText.innerText=`${cart.length} items`;
};

window.startPayment=()=>{
  if(!user||!cart.length) return alert("Login or add items");
  payAmount.innerText=cart.reduce((s,i)=>s+i.price,0);
  paymentModal.style.display="block";
};

window.pay=async(method)=>{
  await addDoc(collection(db,"orders"),{
    uid:user.uid,
    items:cart,
    payment:method,
    status:"Paid (Demo)",
    time:serverTimestamp()
  });
  cart=[]; cartText.innerText="Cart empty";
  paymentModal.style.display="none";
  alert("Payment Successful üéâ");
};

window.closePay=()=>paymentModal.style.display="none";

window.searchProducts=()=>{
  const v=searchInput.value.toLowerCase();
  let found=false;
  document.querySelectorAll(".product").forEach(p=>{
    const ok=p.dataset.name.toLowerCase().includes(v);
    p.style.display=ok?"block":"none";
    if(ok) found=true;
  });
  noResult.classList.toggle("hidden",found);
};

window.toggleTheme=cb=>{
  document.body.classList.toggle("dark",cb.checked);
};

window.show=id=>{
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};
</script>

</body>
</html>
