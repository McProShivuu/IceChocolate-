<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IceChocolate üç´</title>

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#f6e8c3;
}
header{
  background:#3b1f0f;
  color:#fff;
  padding:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
nav button{
  margin:5px;
  padding:8px 14px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.page{display:none;padding:20px;animation:fade 0.4s;}
.page.active{display:block;}
.card{
  background:#fff;
  padding:15px;
  margin:10px;
  border-radius:12px;
  box-shadow:0 5px 15px rgba(0,0,0,0.2);
}
.grid{display:flex;flex-wrap:wrap}
button.primary{
  background:#3b1f0f;
  color:#fff;
}
@keyframes fade{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:none}
}
footer{
  position:fixed;
  bottom:0;
  width:100%;
  background:#fff;
  padding:10px;
  box-shadow:0 -3px 10px rgba(0,0,0,0.2);
}
</style>
</head>

<body>

<header>
  <b>IceChocolate</b>
  <div id="userBox">
    <button onclick="login()" class="primary">Login</button>
  </div>
</header>

<nav>
  <button onclick="show('home')">Home</button>
  <button onclick="show('shop')">Shop</button>
  <button onclick="show('orders')">Orders</button>
</nav>

<div id="home" class="page active">
  <h2>Welcome üç¶</h2>
  <p>Healthy ice creams & chocolates</p>
</div>

<div id="shop" class="page">
  <h2>Shop</h2>
  <div class="grid">
    <div class="card">
      <h3>Protein Ice Cream</h3>
      <p>‚Çπ120</p>
      <button onclick="add('Protein Ice Cream',120)" class="primary">Add</button>
    </div>
    <div class="card">
      <h3>Healthy Chocolate</h3>
      <p>‚Çπ90</p>
      <button onclick="add('Healthy Chocolate',90)" class="primary">Add</button>
    </div>
  </div>
</div>

<div id="orders" class="page">
  <h2>Your Orders</h2>
  <ul id="orderList"></ul>
</div>

<footer>
  <span id="cartText">Cart empty</span>
  <button onclick="placeOrder()" class="primary" style="float:right">Place Order</button>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, addDoc, setDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAm-QUwp0pr0997PdvhMwcDJapL8sGXyWc",
  authDomain: "cafw-32f1d.firebaseapp.com",
  projectId: "cafw-32f1d",
  storageBucket: "cafw-32f1d.firebasestorage.app",
  messagingSenderId: "92588625120",
  appId: "1:92588625120:web:9cb0570bd2dc3622039485"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

let user=null;
let cart=[];

window.login = async ()=>{
  await signInWithPopup(auth,provider);
};

window.logout = ()=>signOut(auth);

onAuthStateChanged(auth,u=>{
  if(u){
    user=u;
    document.getElementById("userBox").innerHTML=
      `${u.email} <button onclick="logout()">Logout</button>`;
    setDoc(doc(db,"users",u.uid),{
      email:u.email,
      lastLogin:serverTimestamp()
    },{merge:true});
  }
});

window.add=(name,price)=>{
  cart.push({name,price});
  document.getElementById("cartText").innerText=`${cart.length} items`;
};

window.placeOrder=async ()=>{
  if(!user){alert("Login first");return;}
  if(cart.length==0){alert("Cart empty");return;}
  await addDoc(collection(db,"orders"),{
    uid:user.uid,
    items:cart,
    time:serverTimestamp()
  });
  alert("Order placed üéâ");
  cart=[];
  document.getElementById("cartText").innerText="Cart empty";
};

window.show=(id)=>{
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};
</script>

</body>
</html>
